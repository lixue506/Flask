function socket_init(){var e=io.connect("http://"+document.domain+":"+location.port);e.on("connect",function(){e.emit("init","")}),e.on("init",function(e){init(e)}),e.on("update",function(e){update(e)})}function socket_init_2(e){var t=io.connect("http://"+document.domain+":"+location.port);t.on("connect",function(){t.emit("init",e)}),t.on("init",function(e){init(e)}),t.on("update",function(e){update(e)})}function setFocus(){$("#main-table").children("div").each(function(e,t){if(e===cursor){$(this).addClass("scroll-focus-row");var r=!1,a=$(t).children("table").children("tbody").children("tr").eq(0);if(a.children("td").each(function(e,t){if($(this).hasClass("pending"))return $(this).addClass("scroll-focus-prob"),focusIndex=e-beforeProbTdNum,!(r=!0)}),!r){for(var n=0,i=0;i<medalNum.length;++i)if(info[e].rank<=medalNum[i]){n=i+1;break}for(i=0;i<medalNum.length;++i)$(t).children("table").children("tbody").children("tr").children("td").eq(0).removeClass("medal-tip-"+(i+1));for(i=0;i<beforeProbTdNum;++i)$(t).children("table").children("tbody").children("tr").children("td").eq(i).addClass("medal-"+n);1<=n&&$("#fs-photo").oneTime("1000ms",function(){setFullScreenPhoto(a.attr("data-user-name"),a.attr("data-nick-name"),a.attr("data-member"),n)})}return!1}})}function init(e){$(".mgdiv h3").remove(),problemNum=e[0].statuses.length,officialNum=e.length-1;for(var t=0;t<medalRatio.length;++t)medalNum[t]=Math.max(t+1,parseInt(Math.floor(officialNum*medalRatio[t])));for(t=0;t<problemNum;++t)$("thead tr:last").append('<th class="single-prob"><a style="color: #'+color[t]+"; background: no-repeat center/36px url(&#39;data:image/svg+xml;utf8,&lt;svg class=&quot;icon&quot; width=&quot;200px&quot; height=&quot;200.00px&quot; viewBox=&quot;0 0 1024 1024&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&lt;path fill=&quot;%23"+balloon[t]+'&quot; d=&quot;M512 935.724137C617.931034 741.517241 847.448276 556.021587 847.448276 370.758621 847.448276 185.495654 697.262966 35.310345 512 35.310345 326.737034 35.310345 176.551724 185.495654 176.551724 370.758621 176.551724 556.021587 423.724137 741.517241 512 935.724137Z&quot; /&gt;&lt;/svg&gt;&#39;);">'+String.fromCharCode(65+t)+"</a></th>");size=Math.min(size,e.length-1),cursor=e[e.length-1].base-1;var r=cursor+1>e.length-2?cursor:cursor+1,a=r-size+1;a<0&&(a=0,r=size-1),cursor-=a;for(t=a;t<=r;++t)info[t-a]=e[t],info[t-a].rank=t+1;for(t=0;t<info.length;++t){var n=info[t].nickname.split("|"),i=n[0],l=n[1],o=n[2];$("#main-table").append('<div class="row row-background"><table class="table table-bordered table-bordered-no-top table-s"><tbody><tr></tr></tbody></table></div>'),$("tbody:last").children("tr").attr("data-user-name",i),$("tbody:last").children("tr").attr("data-nick-name",l),$("tbody:last").children("tr").attr("data-member",o),$("tbody:last").children("tr").append('<td class="single-rank">'+info[t].rank+"</td>"),$("tbody:last").children("tr").append('<td class="single-name">'+l+"<br />"+i+"</td>"),$("tbody:last").children("tr").append('<td class="single-solved">'+info[t].solved+"</td>"),$("tbody:last").children("tr").append('<td class="single-time">'+parseInt(Math.floor(info[t].time/60))+"</td>");for(var s=0;s<info[t].statuses.length;++s){var d="",c="";"AC"===info[t].statuses[s].result||"FB"===info[t].statuses[s].result?d=info[t].statuses[s].attempted+"/"+parseInt(Math.floor(info[t].statuses[s].time/60)):"F"!==info[t].statuses[s].result&&"?"!==info[t].statuses[s].result||(d=info[t].statuses[s].attempted),"AC"===info[t].statuses[s].result&&(c=" accepted"),"FB"===info[t].statuses[s].result&&(c=" fb"),"F"===info[t].statuses[s].result&&(c=" failed"),"?"===info[t].statuses[s].result&&(c=" pending"),$("tbody:last").children("tr").append('<td class="single-prob'+c+'">'+d+"</td>")}if(t>cursor){var u=0;for(s=0;s<medalNum.length;++s)if(info[t].rank<=medalNum[s]){u=s+1;break}for(s=0;s<beforeProbTdNum;++s)$("tbody:last tr").children("td").eq(s).addClass("medal-"+u)}}$("#main-table").append('<div id="extra" class="row row-background" style="top: -9999px; position: absolute; width: 100%;"><table class="table table-bordered table-bordered-no-top table-s"><tbody><tr></tr></tbody></table></div>'),$("tbody:last").children("tr").append('<td class="single-rank"></td>'),$("tbody:last").children("tr").append('<td class="single-name"></td>'),$("tbody:last").children("tr").append('<td class="single-solved"></td>'),$("tbody:last").children("tr").append('<td class="single-time"></td>');for(s=0;s<info[0].statuses.length;++s)$("tbody:last").children("tr").append('<td class="single-prob"></td>');setFocus(),setMedalTip()}function fillRow(e,t){var r=t.nickname.split("|"),a=r[0],n=r[1],i=r[2];e.css("top",0);var l=e.children("table").children("tbody").children("tr");l.eq(0).attr("data-user-name",a),l.eq(0).attr("data-nick-name",n),l.eq(0).attr("data-member",i);var o=e.children("table").children("tbody").children("tr").children("td");o.eq(0).text(t.rank),o.eq(1).html(n+"<br />"+a),o.eq(2).text(t.solved),o.eq(3).text(parseInt(Math.floor(t.time)/60));for(var s=0;s<t.statuses.length;++s){var d="",c="";"AC"===t.statuses[s].result||"FB"===t.statuses[s].result?d=t.statuses[s].attempted+"/"+parseInt(Math.floor(t.statuses[s].time/60)):"F"!==t.statuses[s].result&&"?"!==t.statuses[s].result||(d=t.statuses[s].attempted),o.eq(beforeProbTdNum+s).text(d),o.eq(beforeProbTdNum+s).removeClass("accepted"),o.eq(beforeProbTdNum+s).removeClass("fb"),o.eq(beforeProbTdNum+s).removeClass("failed"),o.eq(beforeProbTdNum+s).removeClass("pending"),"AC"===t.statuses[s].result&&(c="accepted"),"FB"===t.statuses[s].result&&(c="fb"),"F"===t.statuses[s].result&&(c="failed"),"?"===t.statuses[s].result&&(c="pending"),o.eq(beforeProbTdNum+s).addClass(c)}}function resetRanklist(){for(var e=0;e<size;++e){fillRow($("#main-table").children("div").eq(e),info[e]),$("#main-table").children("div").eq(e).removeClass("z-index-middle");for(var t=0;t<beforeProbTdNum;++t)for(var r=0;r<medalNum.length;++r)$("#main-table").children("div").eq(e).children("table").children("tbody").children("tr").children("td").eq(t).removeClass("medal-"+(r+1)),$("#main-table").children("div").eq(e).children("table").children("tbody").children("tr").children("td").eq(0).removeClass("medal-tip-"+(r+1));if(e===cursor&&$("#main-table").children("div").eq(e).children("table").children("tbody").children("tr").children("td").each(function(){if($(this).hasClass("pending"))return!!0}),e>cursor){var a=0;for(t=0;t<medalNum.length;++t)if(info[e].rank<=medalNum[t]){a=t+1;break}for(t=0;t<beforeProbTdNum;++t)$("#main-table").children("div").eq(e).children("table").children("tbody").children("tr").children("td").eq(t).addClass("medal-"+a)}}var n=$("#main-table").children("div").eq(0).position().top;n-=scrollHeightSize,$("#extra").css("top",n),setMedalTip()}function removeMedalTip(){for(var e=0;e<size;++e)for(var t=0;t<medalNum.length;++t)$("#main-table").children("div").eq(e).children("table").children("tbody").children("tr").children("td").eq(0).removeClass("medal-tip-"+(t+1))}function setMedalTip(){removeMedalTip();var r=!1;$("#main-table").children("div").eq(cursor).children("table").children("tbody").children("tr").children("td").each(function(e,t){if($(this).hasClass("pending"))return!(r=!0)});for(var e=0;e<size;++e)if(e<cursor||e===cursor&&r)for(var t=0;t<medalNum.length;++t)info[e].rank!==medalNum[t]||$("#main-table").children("div").eq(e).children("table").children("tbody").children("tr").children("td").eq(0).addClass("medal-tip-"+(t+1))}function update(e){eventID=e.event_id;var t=e.type,r=e.status;if(extra=e.extra,"scroll"===t){$("#main-table").children("div").eq(cursor).removeClass("scroll-focus-row");for(var a=0,n=0;n<medalNum.length;++n)if(info[cursor].rank<=medalNum[n]){a=n+1;break}for(n=0;n<beforeProbTdNum;++n)$("#main-table").children("div").eq(cursor).children("table").children("tbody").children("tr").children("td").eq(n).addClass("medal-"+a);if($("#main-table").children("div").eq(cursor-1).addClass("scroll-focus-row"),0===extra.length)cursor--,setFocus();else{removeMedalTip(),$("#one-scroll").attr("disabled",!0);for(var i=size-1;1<=i;--i)info[i]=info[i-1],$("#main-table").children("div").eq(i).animate({top:scrollHeightSize},1e3,function(){});$("#main-table").children("div").eq(0).animate({top:scrollHeightSize},1e3,function(){}),info[0]=extra,fillRow($("#extra"),info[0]);var l=$("#main-table").children("div").eq(0).position().top;l-=scrollHeightSize,$("#extra").css("top",l),$("#extra").animate({top:l+scrollHeightSize},1e3,function(){$("#main-table").children("div").eq(cursor-1).removeClass("scroll-focus-row"),resetRanklist(),setFocus(),$("#one-scroll").attr("disabled",!1)})}}if("show"===t){r.time-=1200*(r.attempted-1);var o=$("#main-table").children("div").eq(cursor).children("table").children("tbody").children("tr").children("td").eq(focusIndex+beforeProbTdNum);if(info[cursor].statuses[focusIndex].result=r.result,info[cursor].statuses[focusIndex].attempted=r.attempted,info[cursor].statuses[focusIndex].time=r.time,o.removeClass("pending"),o.removeClass("scroll-focus-prob"),"F"===r.result)o.addClass("failed"),setFocus();else{$("#one-scroll").attr("disabled",!0),"AC"===r.result&&o.addClass("accepted"),"FB"===r.result&&o.addClass("fb");var s=info[cursor].rank;info[cursor].rank=r.rank,info[cursor].solved++,info[cursor].time+=1200*(r.attempted-1)+r.time;var d=info[cursor];$("#main-table").children("div").eq(cursor).children("table").children("tbody").children("tr").children("td").eq(0).text(info[cursor].rank),$("#main-table").children("div").eq(cursor).children("table").children("tbody").children("tr").children("td").eq(2).text(info[cursor].solved),$("#main-table").children("div").eq(cursor).children("table").children("tbody").children("tr").children("td").eq(3).text(parseInt(Math.floor(info[cursor].time/60))),o.text(r.attempted+"/"+parseInt(Math.floor(r.time)/60));var c=0;for(removeMedalTip(),i=cursor-1;0<=i&&info[i].rank>=d.rank;--i)info[i].rank++,info[i+1]=info[i],c++,$("#main-table").children("div").eq(i).children("table").children("tbody").children("tr").children("td").eq(0).text(info[i].rank),$("#main-table").children("div").eq(i).animate({top:scrollHeightSize},1e3,function(){});if(info[i+1]=d,s-r.rank>=size-1){$("#main-table").children("div").eq(cursor).addClass("z-index-middle"),info[0]=extra,fillRow($("#extra"),info[0]);l=$("#main-table").children("div").eq(0).position().top;l-=scrollHeightSize,$("#extra").css("top",l),c++,$("#extra").children("table").children("tbody").children("tr").children("td").eq(0).text(info[0].rank),$("#extra").animate({top:l+scrollHeightSize},1e3,function(){})}$("#main-table").children("div").eq(cursor).animate({top:-scrollHeightSize*c},1e3,function(){$("#main-table").children("div").eq(cursor).removeClass("scroll-focus-row"),resetRanklist(),setFocus(),$("#one-scroll").attr("disabled",!1)})}}eventID++}function setFullScreenPhoto(e,t,r,a){$("#fs-real-photo").attr("src","http://acm.sdut.edu.cn/sdutacm_files/contests/2296/images/"+e+".jpg"),$("#fs-info-1").text(t),$("#fs-info-2").text(r),$("#fs-medal").text(medalText[a-1]),$("#fs-photo").show(),$("#fs-photo").oneTime("5000ms",function(){closeFullScreenPhoto()})}function closeFullScreenPhoto(){$("#fs-photo").hide()}size=10,scrollHeightSize=57,info=new Array,extra=new Array,cursor=-1,focusIndex=-1,eventID=0,beforeProbTdNum=4,problemNum=0,officialNum=0,balloon=['912CEE', 'FF82AB', '8B8386', '79CDCD', 'EE9A00', 'CD0000', 'EE7600', 'C71585', '3A5FCD', 'FFFACD', '66CD00',],color=['FFFFFF', 'FFFFFF', 'FFFFFF', 'FFFFFF', 'FFFFFF', 'FFFFFF', 'FFFFFF', 'FFFFFF', 'FFFFFF', '999999', 'FFFFFF',],medalRatio=[.075,.2,.4],medalNum=[],medalText=["一等奖","二等奖","三等奖"],$(function(){var t=$("#scroll-button").find(".btn");t.click(function(){$(this).button("loading"),console.log("here");var e=$(this).data("url");$.ajax({url:e,timeout:5e3,cache:!1,success:function(e){console.log(t),setTimeout(function(){t.button("reset")},1100)},error:function(){}})})});